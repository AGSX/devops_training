---
- name: apt upgrade
  apt: update_cache=yes upgrade=yes cache_valid_time=3600
  become: true
- name: Remove old versions of Docker
  apt: state=absent pkg={{item}}
  with_items:
    - docker
    - docker-engine
    - docker.io
  become: true
- name: Install prerequisite packages for Docker
  apt: state=present pkg={{item}}
  with_items:
    - apt-transport-https
    - ca-certificates
    - curl
    - software-properties-common
  become: true
- name: Add Docker's official GPG key
  apt_key:
    url: https://download.docker.com/linux/ubuntu/gpg
  become: true
- name: Add the Docker key using apt_key to prevent apt/apt-get warnings
  apt_key:
    keyserver: keyserver.ubuntu.com
    id: F76221572C52609D
  become: true
- name: Add the Docker apt repository
  apt_repository:
    repo: "deb [arch=amd64] https://download.docker.com/linux/ubuntu {{ansible_lsb.codename}} stable"
  become: true
- name: Update apt cache
  apt: update_cache=yes
  become: true
- name: Install docker-ce
  apt: pkg=docker-ce
  become: true
- name: Ensure docker group exists
  group: name=docker state=present
  become: true
- name: Add current user to docker group
  user: name="{{ansible_user_id}}" groups=docker
  become: true
